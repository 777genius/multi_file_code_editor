# Symbol Navigator Plugin - Architecture

## ğŸ—ï¸ High-Level Architecture

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FLUTTER UI LAYER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Symbol Navigator Plugin (Dart)                     â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚ PRESENTATION                                        â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ SymbolNavigatorPlugin (BaseEditorPlugin)        â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ UI Descriptor Generation                        â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Event Handlers (onFileOpen, onChange, onClose)  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ State Management (StatefulPlugin)               â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚                           â†“â†‘                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚ DOMAIN LAYER (Pure Business Logic)                 â”‚    â”‚  â”‚
â”‚  â”‚  â”‚                                                     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  Entities:                                          â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ CodeSymbol (name, kind, location, children)     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ SymbolTree (symbols, statistics)                â”‚    â”‚  â”‚
â”‚  â”‚  â”‚                                                     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  Value Objects:                                     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ SymbolKind (16 types: class, method, field...)  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ SymbolLocation (line/column/offset tracking)    â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â†“â†‘
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘  WASM BRIDGE PROTOCOL     â•‘
                    â•‘                           â•‘
                    â•‘  â€¢ MessagePack            â•‘
                    â•‘  â€¢ Packed Pointers        â•‘
                    â•‘  â€¢ Memory Management      â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                 â†“â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GO WASM COMPUTATION LAYER                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Symbol Parser (Go + WASM)                          â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚ WASM EXPORTS                                        â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ get_manifest() â†’ PluginManifest                  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ parse_symbols(ptr, len) â†’ packed(ptr, len)      â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ alloc(size) â†’ ptr                                â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ dealloc(ptr)                                     â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚                           â†“â†‘                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚ PARSER LAYER                                        â”‚    â”‚  â”‚
â”‚  â”‚  â”‚                                                     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  Language Parsers:                                  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ DartParser (regex-based, current)               â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ JavaScriptParser (TODO)                         â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ TypeScriptParser (TODO)                         â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ PythonParser (TODO)                             â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ GoParser (TODO: use stdlib go/parser)           â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ RustParser (TODO)                               â”‚    â”‚  â”‚
â”‚  â”‚  â”‚                                                     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  Future: Tree-sitter Integration                   â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ 10-100x faster                                  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ 99.9% accuracy                                  â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Domain Model

### Entity-Relationship Diagram

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SymbolTree                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + filePath: String                                      â”‚
â”‚ + language: String                                      â”‚
â”‚ + timestamp: DateTime                                   â”‚
â”‚ + parseDurationMs: int?                                 â”‚
â”‚ + symbols: List<CodeSymbol>                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + getAllSymbols(): List<CodeSymbol>                     â”‚
â”‚ + findSymbolByName(name): CodeSymbol?                   â”‚
â”‚ + findSymbolAtLine(line): CodeSymbol?                   â”‚
â”‚ + statistics: Map<String, int>                          â”‚
â”‚ + totalCount: int                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        1
                        â”‚
                        â”‚ contains
                        â”‚
                        â–¼ *
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CodeSymbol                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + name: String                                          â”‚
â”‚ + kind: SymbolKind                                      â”‚
â”‚ + location: SymbolLocation                              â”‚
â”‚ + parentName: String?                                   â”‚
â”‚ + children: List<CodeSymbol>                            â”‚
â”‚ + metadata: Map<String, dynamic>                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + isContainer: bool                                     â”‚
â”‚ + qualifiedName: String                                 â”‚
â”‚ + summary: String                                       â”‚
â”‚ + addChild(child): CodeSymbol                           â”‚
â”‚ + sortChildren(): CodeSymbol                            â”‚
â”‚ + getAllDescendants(): List<CodeSymbol>                 â”‚
â”‚ + findSymbolAtLine(line): CodeSymbol?                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                           â”‚
        â”‚ has                       â”‚ has
        â–¼ 1                         â–¼ 1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SymbolKind     â”‚      â”‚    SymbolLocation           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ class          â”‚      â”‚ + startLine: int            â”‚
â”‚ â€¢ abstractClass  â”‚      â”‚ + startColumn: int          â”‚
â”‚ â€¢ mixin          â”‚      â”‚ + endLine: int              â”‚
â”‚ â€¢ extension      â”‚      â”‚ + endColumn: int            â”‚
â”‚ â€¢ enum           â”‚      â”‚ + startOffset: int          â”‚
â”‚ â€¢ typedef        â”‚      â”‚ + endOffset: int            â”‚
â”‚ â€¢ function       â”‚      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ method         â”‚      â”‚ + lineCount: int            â”‚
â”‚ â€¢ constructor    â”‚      â”‚ + containsLine(line): bool  â”‚
â”‚ â€¢ getter         â”‚      â”‚ + containsOffset(int): bool â”‚
â”‚ â€¢ setter         â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â€¢ field          â”‚
â”‚ â€¢ property       â”‚
â”‚ â€¢ constant       â”‚
â”‚ â€¢ variable       â”‚
â”‚ â€¢ enumValue      â”‚
â”‚ â€¢ parameter      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Sequence Diagram - Parse Flow

```text
User          Plugin         WASM Bridge      Go Parser      Tree-sitter
 â”‚              â”‚                 â”‚               â”‚               â”‚
 â”‚â”€ Open File â”€â–¶â”‚                 â”‚               â”‚               â”‚
 â”‚              â”‚                 â”‚               â”‚               â”‚
 â”‚              â”‚â”€ Schedule â”€â”€â”€â”€â”€â–¶â”‚               â”‚               â”‚
 â”‚              â”‚   (debounce)    â”‚               â”‚               â”‚
 â”‚              â”‚                 â”‚               â”‚               â”‚
 â”‚              â”‚â”€ Detect Lang â”€â”€â–¶â”‚               â”‚               â”‚
 â”‚              â”‚                 â”‚               â”‚               â”‚
 â”‚              â”‚â”€ Serialize â”€â”€â”€â”€â–¶â”‚               â”‚               â”‚
 â”‚              â”‚   MessagePack   â”‚               â”‚               â”‚
 â”‚              â”‚                 â”‚               â”‚               â”‚
 â”‚              â”‚                 â”‚â”€ alloc() â”€â”€â”€â”€â–¶â”‚               â”‚
 â”‚              â”‚                 â”‚               â”‚               â”‚
 â”‚              â”‚                 â”‚â”€ parse_symbols()             â”‚
 â”‚              â”‚                 â”‚               â”‚               â”‚
 â”‚              â”‚                 â”‚               â”‚â”€ ParseSymbols()
 â”‚              â”‚                 â”‚               â”‚               â”‚
 â”‚              â”‚                 â”‚               â”‚â”€ DartParser â”€â–¶â”‚
 â”‚              â”‚                 â”‚               â”‚   (regex)     â”‚
 â”‚              â”‚                 â”‚               â”‚               â”‚
 â”‚              â”‚                 â”‚               â”‚â—€â”€ Symbols â”€â”€â”€â”€â”‚
 â”‚              â”‚                 â”‚               â”‚   (5-10ms)    â”‚
 â”‚              â”‚                 â”‚               â”‚               â”‚
 â”‚              â”‚                 â”‚â—€â”€ packed(ptr,len)             â”‚
 â”‚              â”‚                 â”‚               â”‚               â”‚
 â”‚              â”‚â—€â”€ Deserialize â”€â”€â”‚               â”‚               â”‚
 â”‚              â”‚   SymbolTree    â”‚               â”‚               â”‚
 â”‚              â”‚                 â”‚               â”‚               â”‚
 â”‚â—€â”€ Update UI â”€â”‚                 â”‚               â”‚               â”‚
 â”‚   (tree)     â”‚                 â”‚               â”‚               â”‚
 â”‚              â”‚                 â”‚               â”‚               â”‚
```

## ğŸ§© Component Diagram

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DART PLUGIN                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚         SymbolNavigatorPlugin                         â”‚     â”‚
â”‚  â”‚         (BaseEditorPlugin + StatefulPlugin)           â”‚     â”‚
â”‚  â”‚                                                       â”‚     â”‚
â”‚  â”‚  â€¢ manifest: PluginManifest                           â”‚     â”‚
â”‚  â”‚  â€¢ currentSymbolTree: SymbolTree?                     â”‚     â”‚
â”‚  â”‚  â€¢ _disposed: bool                                    â”‚     â”‚
â”‚  â”‚  â€¢ _parseDebounce: Timer?                             â”‚     â”‚
â”‚  â”‚                                                       â”‚     â”‚
â”‚  â”‚  Methods:                                             â”‚     â”‚
â”‚  â”‚  + onInitialize(context)                              â”‚     â”‚
â”‚  â”‚  + onDispose()                                        â”‚     â”‚
â”‚  â”‚  + onFileOpen(file)                                   â”‚     â”‚
â”‚  â”‚  + onFileContentChange(id, content)                   â”‚     â”‚
â”‚  â”‚  + onFileClose(id)                                    â”‚     â”‚
â”‚  â”‚  + getUIDescriptor(): PluginUIDescriptor?             â”‚     â”‚
â”‚  â”‚  - _scheduleParseFile(file)                           â”‚     â”‚
â”‚  â”‚  - _parseFile(file)                                   â”‚     â”‚
â”‚  â”‚  - _detectLanguage(filename): String                  â”‚     â”‚
â”‚  â”‚  - _parseMockSymbols(content): List<CodeSymbol>       â”‚     â”‚
â”‚  â”‚  - _updateUI()                                        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                          â”‚ uses                                 â”‚
â”‚                          â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                   Domain Models                       â”‚     â”‚
â”‚  â”‚                                                       â”‚     â”‚
â”‚  â”‚  CodeSymbol â”€â”€â–¶ SymbolKind                            â”‚     â”‚
â”‚  â”‚      â”‚          SymbolLocation                        â”‚     â”‚
â”‚  â”‚      â””â”€â”€â–¶ SymbolTree                                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ communicates via
                          â–¼ MessagePack
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GO WASM PLUGIN                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                  main.go (Exports)                    â”‚     â”‚
â”‚  â”‚                                                       â”‚     â”‚
â”‚  â”‚  Exports:                                             â”‚     â”‚
â”‚  â”‚  â€¢ get_manifest() â†’ uint64                            â”‚     â”‚
â”‚  â”‚  â€¢ parse_symbols(ptr, len) â†’ uint64                   â”‚     â”‚
â”‚  â”‚  â€¢ alloc(size) â†’ uint32                               â”‚     â”‚
â”‚  â”‚  â€¢ dealloc(ptr)                                       â”‚     â”‚
â”‚  â”‚                                                       â”‚     â”‚
â”‚  â”‚  Internal:                                            â”‚     â”‚
â”‚  â”‚  - packResult(data, err): uint64                      â”‚     â”‚
â”‚  â”‚  - readMemory(ptr, len): []byte                       â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                          â”‚ uses                                 â”‚
â”‚                          â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚            parser/parser.go (Dispatcher)              â”‚     â”‚
â”‚  â”‚                                                       â”‚     â”‚
â”‚  â”‚  + ParseSymbols(content, lang) â†’ ([]Symbol, Duration) â”‚     â”‚
â”‚  â”‚  - parseDart(content): ([]Symbol, error)              â”‚     â”‚
â”‚  â”‚  - parseJavaScript(content): ([]Symbol, error)        â”‚     â”‚
â”‚  â”‚  - parseTypeScript(content): ([]Symbol, error)        â”‚     â”‚
â”‚  â”‚  - parsePython(content): ([]Symbol, error)            â”‚     â”‚
â”‚  â”‚  - parseGo(content): ([]Symbol, error)                â”‚     â”‚
â”‚  â”‚  - parseRust(content): ([]Symbol, error)              â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                          â”‚ implements                           â”‚
â”‚                          â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚          parser/dart_parser.go (Concrete)             â”‚     â”‚
â”‚  â”‚                                                       â”‚     â”‚
â”‚  â”‚  DartParser:                                          â”‚     â”‚
â”‚  â”‚  + Parse(): ([]Symbol, error)                         â”‚     â”‚
â”‚  â”‚  - parseClasses(): []Symbol                           â”‚     â”‚
â”‚  â”‚  - parseClassMembers(): []Symbol                      â”‚     â”‚
â”‚  â”‚  - parseMixins(): []Symbol                            â”‚     â”‚
â”‚  â”‚  - parseExtensions(): []Symbol                        â”‚     â”‚
â”‚  â”‚  - parseEnums(): []Symbol                             â”‚     â”‚
â”‚  â”‚  - parseTopLevelFunctions(): []Symbol                 â”‚     â”‚
â”‚  â”‚  - parseTopLevelVariables(): []Symbol                 â”‚     â”‚
â”‚  â”‚  - getLineNumber(offset): int                         â”‚     â”‚
â”‚  â”‚  - findMatchingBrace(pos): int                        â”‚     â”‚
â”‚  â”‚  - isInsideClass(offset): bool                        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                          â”‚ uses                                 â”‚
â”‚                          â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚              parser/types.go (Data)                   â”‚     â”‚
â”‚  â”‚                                                       â”‚     â”‚
â”‚  â”‚  Symbol:                                              â”‚     â”‚
â”‚  â”‚  â€¢ Name, Kind, Location, Parent                       â”‚     â”‚
â”‚  â”‚  â€¢ Children: []Symbol                                 â”‚     â”‚
â”‚  â”‚  â€¢ Metadata: map[string]interface{}                   â”‚     â”‚
â”‚  â”‚                                                       â”‚     â”‚
â”‚  â”‚  Location:                                            â”‚     â”‚
â”‚  â”‚  â€¢ StartLine, StartColumn, EndLine, EndColumn         â”‚     â”‚
â”‚  â”‚  â€¢ StartOffset, EndOffset                             â”‚     â”‚
â”‚  â”‚                                                       â”‚     â”‚
â”‚  â”‚  Constants: KindClass, KindMethod, ...                â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Memory Management

### WASM Memory Layout

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WASM Linear Memory                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Host (Dart) Side:                                          â”‚
â”‚  1. Serialize ParseRequest to MessagePack                   â”‚
â”‚  2. Call alloc(size) â†’ get pointer                          â”‚
â”‚  3. Write MessagePack bytes to WASM memory at pointer       â”‚
â”‚  4. Call parse_symbols(ptr, len)                            â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Request Data (MessagePack)                        â”‚    â”‚
â”‚  â”‚  [content][language][filePath]                     â”‚    â”‚
â”‚  â”‚  â†‘                                                  â”‚    â”‚
â”‚  â”‚  ptr (from alloc)                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â”‚  Go (WASM) Side:                                            â”‚
â”‚  5. Read bytes from WASM memory at [ptr:ptr+len]            â”‚
â”‚  6. Deserialize MessagePack to ParseRequest struct          â”‚
â”‚  7. Parse symbols with DartParser                           â”‚
â”‚  8. Serialize ParseResponse to MessagePack                  â”‚
â”‚  9. Allocate new memory for response                        â”‚
â”‚  10. Return packed (ptr << 32) | len                        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Response Data (MessagePack)                       â”‚    â”‚
â”‚  â”‚  [symbols][language][duration][statistics]         â”‚    â”‚
â”‚  â”‚  â†‘                                                  â”‚    â”‚
â”‚  â”‚  response ptr                                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â”‚  Host (Dart) Side:                                          â”‚
â”‚  11. Unpack uint64 â†’ (ptr, len)                             â”‚
â”‚  12. Read bytes from WASM memory at [ptr:ptr+len]           â”‚
â”‚  13. Deserialize MessagePack to ParseResponse               â”‚
â”‚  14. Convert to Dart SymbolTree                             â”‚
â”‚  15. (Optional) Call dealloc(ptr) for cleanup               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Packed Pointer Format (uint64):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Upper 32 bits: Pointer    â”‚  Lower 32 bits: Length    â”‚
â”‚  [ptr ptr ptr ptr]          â”‚  [len len len len]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                OR
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  0xFFFFFFFFFFFFFFFF  â†’  Error (both ptr and len = max)  â”‚
â”‚  0x0000000000000000  â†’  Empty/Error (both zero)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¨ Design Patterns

### 1. **Plugin Pattern**
```dart
interface Plugin {
  PluginManifest manifest
  onInitialize(context)
  onDispose()
}

SymbolNavigatorPlugin implements Plugin, BaseEditorPlugin, StatefulPlugin
```

### 2. **Strategy Pattern** (Language Dispatch)
```go
func ParseSymbols(content, language) {
  switch language {
    case "dart": return parseDart(content)
    case "js":   return parseJavaScript(content)
    // ... more strategies
  }
}
```

### 3. **Composite Pattern** (Symbol Tree)
```dart
CodeSymbol {
  name
  kind
  location
  children: List<CodeSymbol>  // Recursive structure
}
```

### 4. **Observer Pattern** (StatefulPlugin)
```dart
StatefulPlugin {
  ValueNotifier<int> stateChanges
  setState(key, value) {
    _state[key] = value
    _notifier.value++  // Notify observers
  }
}
```

### 5. **Factory Pattern** (SymbolLocation)
```dart
factory SymbolLocation.fromTreeSitter({
  startRow, startCol, endRow, endCol, startByte, endByte
}) {
  return SymbolLocation(...)
}
```

### 6. **Builder Pattern** (PluginManifest)
```dart
PluginManifestBuilder()
  .withId('plugin.symbol-navigator')
  .withName('Symbol Navigator')
  .withVersion('0.1.0')
  .addActivationEvent('onFileOpen')
  .build()
```

## ğŸ“Š Performance Characteristics

### Time Complexity

| Operation | Current (Regex) | Future (Tree-sitter) |
|-----------|-----------------|----------------------|
| Parse 1K lines | O(n) ~5-10ms | O(n) ~0.5-1ms |
| Parse 10K lines | O(n) ~50-100ms | O(n) ~5-10ms |
| Find symbol by name | O(n) | O(1) with index |
| Find symbol at line | O(n) | O(log n) with BST |

### Space Complexity

| Structure | Size | Notes |
|-----------|------|-------|
| SymbolTree | O(n) | n = symbol count |
| CodeSymbol | O(1) | Fixed fields |
| WASM Request | O(m) | m = source length |
| WASM Response | O(n) | n = symbols |

## ğŸ”„ State Management

```text
SymbolNavigatorPlugin State Flow:

[File Opened] â†’ [Debounce 500ms] â†’ [Parse] â†’ [Update State] â†’ [Update UI]
     â†“                                  â†“
  setState('loading', true)      setState('symbolTree', tree)
     â†“                                  â†“
  getUIDescriptor()               setState('loading', false)
```

## ğŸ¯ Extension Points

### Adding New Language Support

1. **Go side:**
```go
// parser/newlang_parser.go
func parseNewLang(content string) ([]Symbol, error) {
  // Implement parser
}

// parser/parser.go
case "newlang":
  symbols, err = parseNewLang(content)
```

2. **Dart side:**
```dart
// symbol_navigator_plugin.dart
String _detectLanguage(String filename) {
  switch (ext) {
    case 'newext': return 'newlang';
  }
}
```

### Adding New Symbol Kind

1. **Dart side:**
```dart
// symbol_kind.dart
const factory SymbolKind.newKind() = _NewKind;

int get iconCode {
  newKind: (_) => 0xXXXX,
}
```

2. **Go side:**
```go
// parser/types.go
const KindNewKind = "new_kind"
```

## ğŸ“š References

- **Clean Architecture**: Domain/Infrastructure separation
- **DDD**: Entities (CodeSymbol), Value Objects (SymbolKind, Location)
- **SOLID**:
  - S: Each class has single responsibility
  - O: Open for extension (new languages)
  - L: Substitutable parsers
  - I: Minimal interfaces
  - D: Depend on abstractions (Parser interface)

## ğŸš€ Future Enhancements

1. **Incremental Parsing**: Only re-parse changed regions
2. **Semantic Analysis**: Type information, scopes
3. **Cross-references**: Find usages, go to definition
4. **Code Actions**: Refactorings based on symbols
5. **LSP Integration**: Use Language Server Protocol for accuracy
6. **Caching**: Cache parsed symbols, invalidate on change
7. **Indexing**: Build search index for fast symbol lookup
8. **Symbol Documentation**: Extract doc comments
